<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<title>O&D ‚Äî The League</title>
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
<style>
:root {
  --bg: #1a2e1a;
  --bg-card: #1f3620;
  --bg-surface: #243d24;
  --accent: #2d5a2d;
  --gold: #c9a84c;
  --cream: #f5f0e8;
  --cream-dim: #b8b0a0;
  --cream-muted: #6b6358;
  --white: #ffffff;
  --green-bright: #4caf50;
  --red: #e57373;
  --yellow: #f5c542;
  --radius: 14px;
  --radius-sm: 8px;
  --font: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'Segoe UI', sans-serif;
}

* { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

html, body {
  font-family: var(--font);
  background-color: var(--bg);
  background-image: repeating-linear-gradient(
    45deg,
    transparent,
    transparent 40px,
    rgba(255,255,255,0.012) 40px,
    rgba(255,255,255,0.012) 41px
  );
  color: var(--cream-dim);
  font-size: 15px;
  line-height: 1.5;
  min-height: 100vh;
  overflow-x: hidden;
  -webkit-font-smoothing: antialiased;
}

body {
  padding-bottom: calc(80px + env(safe-area-inset-bottom, 0px));
}

.app-container {
  max-width: 640px;
  margin: 0 auto;
  padding: 0 16px;
}

/* ‚îÄ‚îÄ Loading ‚îÄ‚îÄ */
#loading-screen {
  position: fixed; inset: 0; z-index: 9999;
  background: var(--bg);
  display: flex; flex-direction: column;
  align-items: center; justify-content: center; gap: 20px;
}
.spinner {
  width: 44px; height: 44px;
  border: 3px solid rgba(255,255,255,0.08);
  border-top-color: var(--gold);
  border-radius: 50%;
  animation: spin 0.8s linear infinite;
}
@keyframes spin { to { transform: rotate(360deg); } }
#loading-screen p { color: var(--cream-muted); font-size: 13px; letter-spacing: 0.05em; text-transform: uppercase; }

/* ‚îÄ‚îÄ Animations ‚îÄ‚îÄ */
@keyframes fadeUp {
  from { opacity: 0; transform: translateY(12px); }
  to { opacity: 1; transform: translateY(0); }
}
@keyframes shimmer {
  0% { background-position: -200% 0; }
  100% { background-position: 200% 0; }
}
.fade-up {
  animation: fadeUp 0.4s ease-out both;
}
.stagger-1 { animation-delay: 0.05s; }
.stagger-2 { animation-delay: 0.1s; }
.stagger-3 { animation-delay: 0.15s; }
.stagger-4 { animation-delay: 0.2s; }
.stagger-5 { animation-delay: 0.25s; }
.stagger-6 { animation-delay: 0.3s; }
.stagger-7 { animation-delay: 0.35s; }
.stagger-8 { animation-delay: 0.4s; }
.stagger-9 { animation-delay: 0.45s; }
.stagger-10 { animation-delay: 0.5s; }

/* ‚îÄ‚îÄ Bottom Nav ‚îÄ‚îÄ */
.bottom-nav {
  position: fixed; bottom: 0; left: 0; right: 0;
  background: #0f1f0f;
  border-top: 1px solid rgba(255,255,255,0.08);
  display: flex;
  height: calc(64px + env(safe-area-inset-bottom, 0px));
  padding-bottom: env(safe-area-inset-bottom, 0px);
  z-index: 1000;
}
.nav-tab {
  flex: 1;
  display: flex; flex-direction: column;
  align-items: center; justify-content: center;
  gap: 4px;
  background: none; border: none;
  color: var(--cream-muted);
  cursor: pointer;
  position: relative;
  transition: color 0.2s;
  padding: 8px 0;
}
.nav-tab.active { color: var(--cream); }
.nav-tab.active::after {
  content: '';
  position: absolute;
  top: 0; left: 50%; transform: translateX(-50%);
  width: 28px; height: 3px;
  background: var(--gold);
  border-radius: 0 0 3px 3px;
}
.nav-tab .nav-icon { font-size: 20px; line-height: 1; }
.nav-tab .nav-label {
  font-size: 10px; text-transform: uppercase;
  letter-spacing: 0.08em; font-weight: 600;
}

/* ‚îÄ‚îÄ Tab Panels ‚îÄ‚îÄ */
.tab-panel { display: none; padding-top: 16px; padding-bottom: 20px; }
.tab-panel.active { display: block; }

/* ‚îÄ‚îÄ Cards ‚îÄ‚îÄ */
.card {
  background: var(--bg-card);
  border: 1px solid rgba(255,255,255,0.08);
  border-radius: var(--radius);
  padding: 20px;
  box-shadow: 0 2px 12px rgba(0,0,0,0.3);
  margin-bottom: 14px;
}

/* ‚îÄ‚îÄ Header ‚îÄ‚îÄ */
.app-header {
  text-align: center;
  padding: 24px 0 8px;
}
.app-header .badge {
  display: inline-block;
  background: linear-gradient(135deg, var(--gold), #b8942f);
  color: #1a2e1a;
  font-size: 18px;
  font-weight: 800;
  letter-spacing: 0.06em;
  padding: 6px 18px;
  border-radius: 6px;
  margin-bottom: 8px;
}
.app-header h1 {
  font-size: 22px; font-weight: 700;
  color: var(--cream);
  letter-spacing: -0.01em;
}
.app-header .subtitle {
  font-size: 12px; text-transform: uppercase;
  letter-spacing: 0.12em; color: var(--cream-muted);
  margin-top: 2px;
}

/* ‚îÄ‚îÄ Section labels ‚îÄ‚îÄ */
.section-label {
  font-size: 11px; text-transform: uppercase;
  letter-spacing: 0.1em; color: var(--cream-muted);
  font-weight: 600; margin-bottom: 10px;
}

/* ‚îÄ‚îÄ Status pills ‚îÄ‚îÄ */
.pill {
  display: inline-block;
  font-size: 11px; font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 0.06em;
  padding: 4px 12px;
  border-radius: 20px;
}
.pill-open { background: rgba(245,197,66,0.15); color: var(--yellow); }
.pill-locked { background: rgba(229,115,115,0.15); color: var(--red); }
.pill-revealed { background: rgba(76,175,80,0.15); color: var(--green-bright); }

/* ‚îÄ‚îÄ Picks Tab ‚îÄ‚îÄ */
.week-card-header {
  display: flex; align-items: center; justify-content: space-between;
  margin-bottom: 4px;
}
.week-card-header h2 {
  font-size: 17px; font-weight: 700; color: var(--cream);
}
.week-card .tournament-name {
  font-size: 14px; color: var(--cream-dim);
}

.week-selector {
  margin: 14px 0;
}
.week-selector select {
  width: 100%;
  background: var(--bg-surface);
  border: 1px solid rgba(255,255,255,0.1);
  border-radius: var(--radius-sm);
  color: var(--cream);
  font-size: 14px;
  padding: 10px 14px;
  appearance: none;
  -webkit-appearance: none;
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='8'%3E%3Cpath d='M1 1l5 5 5-5' stroke='%236b6358' stroke-width='1.5' fill='none'/%3E%3C/svg%3E");
  background-repeat: no-repeat;
  background-position: right 14px center;
  cursor: pointer;
}

.pick-form { margin-top: 14px; }
.pick-form label {
  display: block; font-size: 12px; text-transform: uppercase;
  letter-spacing: 0.08em; color: var(--cream-muted);
  font-weight: 600; margin-bottom: 6px;
}
.pick-form select, .pick-form input[type="text"] {
  width: 100%;
  background: var(--bg-surface);
  border: 1px solid rgba(255,255,255,0.1);
  border-radius: var(--radius-sm);
  color: var(--cream);
  font-size: 15px;
  padding: 12px 14px;
  margin-bottom: 12px;
  font-family: var(--font);
}
.pick-form input[type="text"]::placeholder { color: var(--cream-muted); }
.pick-form select {
  appearance: none; -webkit-appearance: none;
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='8'%3E%3Cpath d='M1 1l5 5 5-5' stroke='%236b6358' stroke-width='1.5' fill='none'/%3E%3C/svg%3E");
  background-repeat: no-repeat;
  background-position: right 14px center;
  cursor: pointer;
}
.btn-submit {
  width: 100%;
  background: linear-gradient(135deg, var(--gold), #b8942f);
  color: #1a2e1a;
  font-size: 15px;
  font-weight: 700;
  letter-spacing: 0.04em;
  border: none;
  border-radius: var(--radius-sm);
  padding: 14px;
  cursor: pointer;
  transition: transform 0.15s, opacity 0.15s;
}
.btn-submit:active { transform: scale(0.97); opacity: 0.9; }
.btn-submit:disabled { opacity: 0.5; cursor: not-allowed; }

.entries-section { margin-top: 16px; }
.entries-pills { display: flex; flex-wrap: wrap; gap: 8px; margin-top: 8px; }
.entry-pill {
  background: var(--bg-surface);
  border: 1px solid rgba(255,255,255,0.06);
  border-radius: 20px;
  padding: 6px 14px;
  font-size: 13px; color: var(--cream-dim);
  display: flex; align-items: center; gap: 6px;
}
.entry-pill .dot {
  width: 6px; height: 6px;
  border-radius: 50%;
  background: var(--green-bright);
}

.revealed-table { margin-top: 16px; width: 100%; }
.revealed-table table { width: 100%; border-collapse: collapse; }
.revealed-table th {
  font-size: 11px; text-transform: uppercase;
  letter-spacing: 0.08em; color: var(--cream-muted);
  font-weight: 600; text-align: left;
  padding: 8px 8px 10px;
  border-bottom: 1px solid rgba(255,255,255,0.06);
}
.revealed-table td {
  padding: 10px 8px;
  font-size: 14px; color: var(--cream-dim);
  border-bottom: 1px solid rgba(255,255,255,0.04);
}
.revealed-table tr:last-child td { border-bottom: none; }

.last-updated {
  text-align: center; margin-top: 14px;
  font-size: 12px; color: var(--cream-muted);
  cursor: pointer;
}
.last-updated:active { opacity: 0.6; }

/* ‚îÄ‚îÄ Admin Panel ‚îÄ‚îÄ */
.admin-panel {
  margin-top: 40px;
  padding-top: 20px;
  border-top: 1px solid rgba(255,255,255,0.04);
  opacity: 0.3;
  transition: opacity 0.3s;
}
.admin-panel:hover, .admin-panel:focus-within { opacity: 1; }
.admin-label {
  font-size: 10px; text-transform: uppercase;
  letter-spacing: 0.12em; color: var(--cream-muted);
  margin-bottom: 10px;
}
.admin-row {
  display: flex; gap: 8px; flex-wrap: wrap;
}
.btn-admin {
  background: var(--bg-surface);
  border: 1px solid rgba(255,255,255,0.08);
  border-radius: var(--radius-sm);
  color: var(--cream-muted);
  font-size: 12px; font-weight: 600;
  padding: 8px 14px;
  cursor: pointer;
  transition: border-color 0.2s, color 0.2s;
}
.btn-admin:hover { border-color: var(--gold); color: var(--cream); }
.admin-input {
  background: var(--bg-surface);
  border: 1px solid rgba(255,255,255,0.08);
  border-radius: var(--radius-sm);
  color: var(--cream);
  font-size: 12px;
  padding: 8px 12px;
  width: 160px;
  font-family: var(--font);
}

/* ‚îÄ‚îÄ Standings Tab ‚îÄ‚îÄ */
.winner-banner {
  background: linear-gradient(135deg, rgba(201,168,76,0.15), rgba(201,168,76,0.05));
  border: 1px solid rgba(201,168,76,0.3);
  border-radius: var(--radius);
  padding: 24px 20px;
  text-align: center;
  margin-bottom: 18px;
  position: relative;
  overflow: hidden;
}
.winner-banner::before {
  content: '';
  position: absolute; inset: 0;
  background: linear-gradient(90deg, transparent, rgba(201,168,76,0.08), transparent);
  background-size: 200% 100%;
  animation: shimmer 3s ease-in-out infinite;
}
.winner-banner .trophy { font-size: 32px; margin-bottom: 6px; }
.winner-banner .winner-name {
  font-size: 22px; font-weight: 800; color: var(--gold);
  letter-spacing: -0.01em; position: relative;
}
.winner-banner .winner-lead {
  font-size: 13px; color: var(--cream-dim);
  margin-top: 4px; position: relative;
}

.podium {
  display: flex; align-items: flex-end;
  justify-content: center;
  gap: 10px;
  margin-bottom: 24px;
  padding: 0 10px;
}
.podium-spot {
  flex: 1; max-width: 120px;
  text-align: center;
  background: var(--bg-card);
  border: 1px solid rgba(255,255,255,0.08);
  border-radius: var(--radius);
  padding: 16px 8px;
}
.podium-spot.first {
  order: 2;
  padding: 22px 8px;
  border-color: rgba(201,168,76,0.25);
  background: linear-gradient(180deg, rgba(201,168,76,0.08), var(--bg-card));
}
.podium-spot.second { order: 1; }
.podium-spot.third { order: 3; }
.podium-medal { font-size: 26px; margin-bottom: 6px; }
.podium-name {
  font-size: 14px; font-weight: 700; color: var(--cream);
  margin-bottom: 4px;
}
.podium-earnings {
  font-size: 13px; font-weight: 600; color: var(--green-bright);
  font-variant-numeric: tabular-nums;
}

.rankings-list { margin-top: 4px; }
.rank-row {
  display: flex; align-items: center;
  padding: 14px 16px;
  background: var(--bg-card);
  border: 1px solid rgba(255,255,255,0.06);
  border-radius: var(--radius-sm);
  margin-bottom: 8px;
  gap: 14px;
}
.rank-num {
  font-size: 16px; font-weight: 800;
  color: var(--cream-muted);
  width: 28px; text-align: center;
  flex-shrink: 0;
}
.rank-row:nth-child(1) .rank-num { color: var(--gold); }
.rank-row:nth-child(2) .rank-num { color: #c0c0c0; }
.rank-row:nth-child(3) .rank-num { color: #cd7f32; }
.rank-info { flex: 1; min-width: 0; }
.rank-name { font-size: 15px; font-weight: 700; color: var(--cream); }
.rank-avg {
  font-size: 12px; color: var(--cream-muted);
  margin-top: 1px;
}
.rank-total {
  font-size: 16px; font-weight: 700;
  color: var(--green-bright);
  font-variant-numeric: tabular-nums;
  text-align: right;
  flex-shrink: 0;
}
.rank-bar-container {
  position: absolute; bottom: 0; left: 0; right: 0;
  height: 3px; background: rgba(255,255,255,0.04);
  border-radius: 0 0 var(--radius-sm) var(--radius-sm);
  overflow: hidden;
}
.rank-bar {
  height: 100%;
  background: linear-gradient(90deg, var(--green-bright), var(--gold));
  border-radius: 3px;
  transition: width 0.6s ease-out;
}
.rank-row { position: relative; overflow: hidden; }

/* ‚îÄ‚îÄ History Tab ‚îÄ‚îÄ */
.summary-chips {
  display: flex; gap: 8px; flex-wrap: wrap;
  margin-bottom: 16px;
}
.summary-chip {
  background: var(--bg-surface);
  border: 1px solid rgba(255,255,255,0.06);
  border-radius: 20px;
  padding: 6px 14px;
  font-size: 12px; font-weight: 600;
  color: var(--cream-dim);
}

.tourney-card {
  background: var(--bg-card);
  border: 1px solid rgba(255,255,255,0.08);
  border-radius: var(--radius);
  margin-bottom: 10px;
  overflow: hidden;
  box-shadow: 0 2px 12px rgba(0,0,0,0.3);
}
.tourney-header {
  display: flex; align-items: center; justify-content: space-between;
  padding: 16px 18px;
  cursor: pointer;
  user-select: none;
  -webkit-user-select: none;
}
.tourney-header:active { background: rgba(255,255,255,0.02); }
.tourney-title-group { flex: 1; min-width: 0; }
.tourney-name {
  font-size: 15px; font-weight: 700; color: var(--cream);
  white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
}
.tourney-date { font-size: 12px; color: var(--cream-muted); margin-top: 1px; }
.tourney-mini-bar {
  width: 60px; height: 6px;
  background: rgba(255,255,255,0.06);
  border-radius: 3px;
  overflow: hidden;
  margin-left: 12px;
  flex-shrink: 0;
}
.tourney-mini-bar-fill {
  height: 100%;
  background: var(--green-bright);
  border-radius: 3px;
}
.tourney-chevron {
  margin-left: 10px;
  color: var(--cream-muted);
  transition: transform 0.2s;
  flex-shrink: 0;
  font-size: 14px;
}
.tourney-card.expanded .tourney-chevron { transform: rotate(180deg); }

.tourney-body {
  max-height: 0;
  overflow: hidden;
  transition: max-height 0.35s ease;
}
.tourney-card.expanded .tourney-body {
  max-height: 800px;
}
.tourney-body-inner { padding: 0 18px 16px; }
.tourney-pick-row {
  display: flex; align-items: center; justify-content: space-between;
  padding: 8px 0;
  border-bottom: 1px solid rgba(255,255,255,0.04);
}
.tourney-pick-row:last-child { border-bottom: none; }
.tpr-left { display: flex; align-items: center; gap: 10px; flex: 1; min-width: 0; }
.tpr-rank {
  font-size: 12px; font-weight: 700;
  color: var(--cream-muted);
  width: 20px; text-align: center; flex-shrink: 0;
}
.tpr-rank.first { color: var(--gold); }
.tpr-name { font-size: 14px; font-weight: 600; color: var(--cream); }
.tpr-pick {
  font-size: 12px; color: var(--cream-muted);
  white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
}
.tpr-pick.no-pick { color: var(--red); opacity: 0.6; }
.tpr-earnings {
  font-size: 14px; font-weight: 700;
  font-variant-numeric: tabular-nums;
  flex-shrink: 0; margin-left: 10px;
}
.tpr-earnings.positive { color: var(--green-bright); }
.tpr-earnings.zero { color: var(--cream-muted); }
.tpr-trophy { margin-left: 4px; font-size: 12px; }

/* ‚îÄ‚îÄ Players Tab ‚îÄ‚îÄ */
.most-picked-list { margin-top: 6px; }
.mp-row {
  display: flex; align-items: center;
  padding: 10px 0;
  border-bottom: 1px solid rgba(255,255,255,0.04);
  gap: 12px;
}
.mp-row:last-child { border-bottom: none; }
.mp-rank {
  font-size: 14px; font-weight: 800;
  color: var(--cream-muted);
  width: 26px; text-align: center; flex-shrink: 0;
}
.mp-name { font-size: 14px; font-weight: 600; color: var(--cream); flex: 1; }
.mp-count { font-size: 12px; color: var(--cream-muted); flex-shrink: 0; }
.mp-earnings {
  font-size: 13px; font-weight: 600;
  color: var(--green-bright);
  font-variant-numeric: tabular-nums;
  flex-shrink: 0;
  width: 90px; text-align: right;
}

.member-card {
  background: var(--bg-card);
  border: 1px solid rgba(255,255,255,0.08);
  border-radius: var(--radius);
  margin-bottom: 8px;
  overflow: hidden;
}
.member-card-header {
  display: flex; align-items: center; justify-content: space-between;
  padding: 14px 18px;
  cursor: pointer;
  user-select: none;
  -webkit-user-select: none;
}
.member-card-header:active { background: rgba(255,255,255,0.02); }
.member-card-name { font-size: 15px; font-weight: 700; color: var(--cream); }
.member-card-count { font-size: 12px; color: var(--cream-muted); }
.member-card-chevron {
  color: var(--cream-muted); transition: transform 0.2s;
  font-size: 14px;
}
.member-card.expanded .member-card-chevron { transform: rotate(180deg); }
.member-card-body {
  max-height: 0; overflow: hidden;
  transition: max-height 0.35s ease;
}
.member-card.expanded .member-card-body { max-height: 2000px; }
.member-card-body-inner { padding: 0 18px 14px; }
.member-pick-item {
  display: flex; align-items: center; justify-content: space-between;
  padding: 7px 0;
  border-bottom: 1px solid rgba(255,255,255,0.04);
  font-size: 13px;
}
.member-pick-item:last-child { border-bottom: none; }
.mpi-tourney { color: var(--cream-muted); font-size: 11px; flex-shrink: 0; width: 65px; }
.mpi-golfer { color: var(--cream); font-weight: 600; flex: 1; padding: 0 8px; }
.mpi-earnings {
  font-variant-numeric: tabular-nums;
  font-weight: 600; flex-shrink: 0;
}
.mpi-earnings.positive { color: var(--green-bright); }
.mpi-earnings.zero { color: var(--cream-muted); }

/* ‚îÄ‚îÄ Toast ‚îÄ‚îÄ */
.toast-container {
  position: fixed;
  bottom: calc(80px + env(safe-area-inset-bottom, 0px));
  left: 50%; transform: translateX(-50%);
  z-index: 5000;
  pointer-events: none;
}
.toast {
  padding: 10px 20px;
  border-radius: var(--radius-sm);
  font-size: 13px; font-weight: 600;
  color: var(--white);
  margin-bottom: 8px;
  animation: fadeUp 0.3s ease-out;
  pointer-events: auto;
  white-space: nowrap;
}
.toast-success { background: rgba(76,175,80,0.9); }
.toast-error { background: rgba(229,115,115,0.9); }
.toast-info { background: rgba(201,168,76,0.9); color: #1a2e1a; }

/* ‚îÄ‚îÄ Utilities ‚îÄ‚îÄ */
.hidden { display: none !important; }
.text-gold { color: var(--gold); }
.text-green { color: var(--green-bright); }
.text-red { color: var(--red); }
.mt-16 { margin-top: 16px; }
.mb-8 { margin-bottom: 8px; }
</style>
</head>
<body>

<!-- Loading Screen -->
<div id="loading-screen">
  <div class="spinner"></div>
  <p>Loading League Data‚Ä¶</p>
</div>

<!-- App -->
<div class="app-container" id="app" style="display:none;">

  <!-- ‚îÄ‚îÄ‚îÄ TAB: PICKS ‚îÄ‚îÄ‚îÄ -->
  <div class="tab-panel active" id="tab-picks">
    <div class="app-header fade-up">
      <div class="badge">O&D</div>
      <h1>The League</h1>
      <div class="subtitle">2025 Season</div>
    </div>

    <div class="card fade-up stagger-1" id="current-week-card">
      <div class="week-card-header">
        <h2 id="week-title">Week 1</h2>
        <span class="pill pill-open" id="week-status">Open</span>
      </div>
      <div class="tournament-name" id="week-tournament">Loading‚Ä¶</div>
    </div>

    <div class="week-selector fade-up stagger-2 hidden" id="week-selector-wrapper">
      <select id="week-selector" aria-label="Select week"></select>
    </div>

    <div class="card fade-up stagger-3" id="pick-form-card">
      <div class="pick-form">
        <label for="pick-name">Your Name</label>
        <select id="pick-name">
          <option value="">Select your name‚Ä¶</option>
          <option>Hiatt</option><option>Caden</option><option>Bennett</option>
          <option>Ryan</option><option>William</option><option>Ian</option>
          <option>Mason</option><option>Tim</option><option>Drew</option><option>Ben</option>
        </select>
        <label for="pick-golfer">Your Pick</label>
        <input type="text" id="pick-golfer" placeholder="Enter golfer name‚Ä¶" autocomplete="off" autocapitalize="words">
        <button class="btn-submit" id="btn-submit" onclick="submitPick()">Lock It In</button>
      </div>
    </div>

    <div class="entries-section fade-up stagger-4" id="entries-section">
      <div class="section-label">Confirmed Entries</div>
      <div class="entries-pills" id="entries-pills"></div>
    </div>

    <div class="revealed-table fade-up stagger-4 hidden" id="revealed-section">
      <div class="section-label">Revealed Picks</div>
      <table>
        <thead><tr><th>Member</th><th>Pick</th><th>Submitted</th></tr></thead>
        <tbody id="revealed-tbody"></tbody>
      </table>
    </div>

    <div class="last-updated" id="last-updated" onclick="refreshData()"></div>

    <!-- Admin -->
    <div class="admin-panel">
      <div class="admin-label">Admin</div>
      <div class="admin-row" id="admin-pre-auth">
        <input type="password" class="admin-input" id="admin-key" placeholder="Admin key‚Ä¶">
        <button class="btn-admin" onclick="authAdmin()">Authenticate</button>
      </div>
      <div class="admin-row hidden" id="admin-controls">
        <button class="btn-admin" onclick="adminAction('reveal')">Force Reveal</button>
        <button class="btn-admin" onclick="adminAction('advanceWeek')">Advance Week</button>
      </div>
    </div>
  </div>

  <!-- ‚îÄ‚îÄ‚îÄ TAB: STANDINGS ‚îÄ‚îÄ‚îÄ -->
  <div class="tab-panel" id="tab-standings">
    <div id="standings-content"></div>
  </div>

  <!-- ‚îÄ‚îÄ‚îÄ TAB: HISTORY ‚îÄ‚îÄ‚îÄ -->
  <div class="tab-panel" id="tab-history">
    <div id="history-content"></div>
  </div>

  <!-- ‚îÄ‚îÄ‚îÄ TAB: PLAYERS ‚îÄ‚îÄ‚îÄ -->
  <div class="tab-panel" id="tab-players">
    <div id="players-content"></div>
  </div>

</div>

<!-- Bottom Nav -->
<nav class="bottom-nav" id="bottom-nav" style="display:none;">
  <button class="nav-tab active" data-tab="picks" onclick="switchTab('picks')">
    <span class="nav-icon">üèåÔ∏è</span>
    <span class="nav-label">Picks</span>
  </button>
  <button class="nav-tab" data-tab="standings" onclick="switchTab('standings')">
    <span class="nav-icon">üèÜ</span>
    <span class="nav-label">Standings</span>
  </button>
  <button class="nav-tab" data-tab="history" onclick="switchTab('history')">
    <span class="nav-icon">üìã</span>
    <span class="nav-label">History</span>
  </button>
  <button class="nav-tab" data-tab="players" onclick="switchTab('players')">
    <span class="nav-icon">‚õ≥</span>
    <span class="nav-label">Players</span>
  </button>
</nav>

<!-- Toast Container -->
<div class="toast-container" id="toast-container"></div>

<script>
// ‚îÄ‚îÄ Config ‚îÄ‚îÄ
const CF_BASE = 'https://golf-pickem-weekly.hiattgafnea0.workers.dev';
const SHEET_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQs22oFFItCqxK4oSjw68DRmVXovuv6PgKm7koaGsjj1eLoDWPoYMGIRB7CdV7P3z6Na9Tdara8D-SD/pub?output=csv';
const MEMBERS = ['Hiatt','Caden','Bennett','Ryan','William','Ian','Mason','Tim','Drew','Ben'];

let sheetData = { tournaments: [], standings: {}, winner: { name: '', by: '' } };
let cfStatus = {};
let cfWeeks = [];
let currentViewWeek = null;
let adminKey = localStorage.getItem('golf_admin_key') || '';
let lastFetchTime = null;

// ‚îÄ‚îÄ CSV Parser ‚îÄ‚îÄ
function parseCSV(text) {
  const rows = [];
  let current = '', inQuotes = false, row = [];
  for (let i = 0; i < text.length; i++) {
    const ch = text[i];
    if (inQuotes) {
      if (ch === '"' && text[i+1] === '"') { current += '"'; i++; }
      else if (ch === '"') { inQuotes = false; }
      else { current += ch; }
    } else {
      if (ch === '"') { inQuotes = true; }
      else if (ch === ',') { row.push(current.trim()); current = ''; }
      else if (ch === '\n' || (ch === '\r' && text[i+1] === '\n')) {
        row.push(current.trim()); current = '';
        if (ch === '\r') i++;
        rows.push(row); row = [];
      } else { current += ch; }
    }
  }
  if (current || row.length) { row.push(current.trim()); rows.push(row); }
  return rows;
}

function parseDollar(val) {
  if (!val) return 0;
  return parseFloat(String(val).replace(/[$,]/g, '')) || 0;
}

function fmtDollar(n) {
  if (!n && n !== 0) return '$0';
  return '$' + Math.round(n).toLocaleString('en-US');
}

// ‚îÄ‚îÄ Fetch Sheet Data ‚îÄ‚îÄ
async function fetchSheetData() {
  try {
    const resp = await fetch(SHEET_URL);
    const text = await resp.text();
    const rows = parseCSV(text);
    if (rows.length < 2) return;

    // Skip header row
    const dataRows = rows.slice(1);
    const tournaments = [];
    const meta = { winner: '', by: '', totals: {}, avgs: {} };
    let section = null;

    for (const row of dataRows) {
      const colA = (row[0] || '').trim();
      const colX = (row[23] || '').trim();
      const colY = (row[24] || '').trim();

      // Parse meta from columns X-Y
      if (colX.startsWith('Winning')) { meta.winner = colY; section = null; }
      else if (colX.startsWith('By')) { meta.by = colY; section = null; }
      else if (colX.startsWith('Total')) { section = 'totals'; }
      else if (colX.startsWith('AVG Week')) { section = 'avgs'; }
      else if (section === 'totals' && colX) { meta.totals[colX.replace(':', '').trim()] = parseDollar(colY); }
      else if (section === 'avgs' && colX) { meta.avgs[colX.replace(':', '').trim()] = parseDollar(colY); }

      // Parse tournament rows from columns A-V
      if (!colA) continue;
      const skipLabels = ['winning:', 'by:', 'total:', 'avg week $', 'avg week'];
      if (skipLabels.some(s => colA.toLowerCase().startsWith(s))) continue;

      const picks = [];
      let hasPicks = false;
      for (let i = 0; i < 10; i++) {
        const pick = (row[2 + i] || '').trim();
        const earnings = parseDollar(row[12 + i]);
        if (pick) hasPicks = true;
        picks.push({ member: MEMBERS[i], pick, earnings });
      }
      if (hasPicks) {
        tournaments.push({
          name: colA,
          date: (row[1] || '').trim(),
          picks
        });
      }
    }

    sheetData.tournaments = tournaments;
    sheetData.winner = { name: meta.winner, by: meta.by };
    sheetData.standings = { totals: meta.totals, avgs: meta.avgs };
    lastFetchTime = Date.now();
  } catch (e) {
    console.error('Sheet fetch error:', e);
    showToast('Failed to load sheet data', 'error');
  }
}

// ‚îÄ‚îÄ Fetch CF Data ‚îÄ‚îÄ
async function fetchCFStatus() {
  try {
    const resp = await fetch(CF_BASE + '/status');
    cfStatus = await resp.json();
  } catch (e) {
    console.error('CF status error:', e);
  }
}

async function fetchCFWeeks() {
  try {
    const resp = await fetch(CF_BASE + '/weeks');
    const data = await resp.json();
    cfWeeks = data.weeks || [];
  } catch (e) {
    console.error('CF weeks error:', e);
  }
}

async function fetchWeekPicks(week) {
  try {
    const resp = await fetch(CF_BASE + '/picks?week=' + week);
    return await resp.json();
  } catch (e) {
    console.error('CF picks error:', e);
    return null;
  }
}

// ‚îÄ‚îÄ Toast ‚îÄ‚îÄ
function showToast(msg, type = 'info') {
  const container = document.getElementById('toast-container');
  const toast = document.createElement('div');
  toast.className = 'toast toast-' + type;
  toast.textContent = msg;
  container.appendChild(toast);
  setTimeout(() => { toast.style.opacity = '0'; toast.style.transition = 'opacity 0.3s'; }, 2500);
  setTimeout(() => toast.remove(), 2900);
}

// ‚îÄ‚îÄ Tab Switching ‚îÄ‚îÄ
function switchTab(tabId) {
  document.querySelectorAll('.tab-panel').forEach(p => p.classList.remove('active'));
  document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
  document.getElementById('tab-' + tabId).classList.add('active');
  document.querySelector(`.nav-tab[data-tab="${tabId}"]`).classList.add('active');

  // Re-trigger animations
  const panel = document.getElementById('tab-' + tabId);
  panel.querySelectorAll('.fade-up').forEach(el => {
    el.style.animation = 'none';
    el.offsetHeight;
    el.style.animation = '';
  });

  // Render tab content
  if (tabId === 'standings') renderStandings();
  else if (tabId === 'history') renderHistory();
  else if (tabId === 'players') renderPlayers();
}

// ‚îÄ‚îÄ Picks Tab ‚îÄ‚îÄ
async function renderPicksTab(weekNum) {
  const data = await fetchWeekPicks(weekNum || cfStatus.currentWeek);
  if (!data) return;

  currentViewWeek = data.week;
  const isCurrentWeek = data.week === cfStatus.currentWeek;

  document.getElementById('week-title').textContent = 'Week ' + data.week;
  document.getElementById('week-tournament').textContent = data.tournament || 'TBD';

  // Status pill
  const statusEl = document.getElementById('week-status');
  statusEl.className = 'pill';
  if (data.revealed) { statusEl.classList.add('pill-revealed'); statusEl.textContent = 'Revealed'; }
  else if (data.locked) { statusEl.classList.add('pill-locked'); statusEl.textContent = 'Locked'; }
  else { statusEl.classList.add('pill-open'); statusEl.textContent = 'Open'; }

  // Show/hide form
  const formCard = document.getElementById('pick-form-card');
  if (isCurrentWeek && !data.locked && !data.revealed) {
    formCard.classList.remove('hidden');
  } else {
    formCard.classList.add('hidden');
  }

  // Entries / Revealed
  const entriesSection = document.getElementById('entries-section');
  const revealedSection = document.getElementById('revealed-section');
  const submitted = data.submitted || [];
  const picks = data.picks || {};

  if (data.revealed) {
    entriesSection.classList.add('hidden');
    revealedSection.classList.remove('hidden');
    const tbody = document.getElementById('revealed-tbody');
    tbody.innerHTML = '';
    for (const name of MEMBERS) {
      const pickData = picks[name];
      if (!pickData) continue;
      const tr = document.createElement('tr');
      tr.innerHTML = `<td style="font-weight:600;color:var(--cream)">${name}</td>
        <td>${pickData.pick || '‚Äî'}</td>
        <td style="font-size:12px;color:var(--cream-muted)">${pickData.ts ? new Date(pickData.ts).toLocaleString('en-US',{month:'short',day:'numeric',hour:'numeric',minute:'2-digit',timeZone:'America/New_York'}) : '‚Äî'}</td>`;
      tbody.appendChild(tr);
    }
  } else {
    revealedSection.classList.add('hidden');
    entriesSection.classList.remove('hidden');
    const pills = document.getElementById('entries-pills');
    pills.innerHTML = '';
    if (submitted.length === 0) {
      pills.innerHTML = '<span style="font-size:13px;color:var(--cream-muted)">No picks yet</span>';
    } else {
      submitted.forEach(name => {
        pills.innerHTML += `<span class="entry-pill"><span class="dot"></span>${name}</span>`;
      });
    }
  }

  // Last updated
  updateLastUpdated();
}

function updateLastUpdated() {
  const el = document.getElementById('last-updated');
  if (!lastFetchTime) { el.textContent = ''; return; }
  const mins = Math.floor((Date.now() - lastFetchTime) / 60000);
  el.textContent = mins < 1 ? 'Updated just now ¬∑ Tap to refresh' : `Updated ${mins}m ago ¬∑ Tap to refresh`;
}

async function refreshData() {
  showToast('Refreshing‚Ä¶', 'info');
  await Promise.all([fetchSheetData(), fetchCFStatus()]);
  await renderPicksTab(currentViewWeek);
  showToast('Data refreshed', 'success');
}

// ‚îÄ‚îÄ Week Selector ‚îÄ‚îÄ
function renderWeekSelector() {
  const wrapper = document.getElementById('week-selector-wrapper');
  if (cfWeeks.length <= 1) { wrapper.classList.add('hidden'); return; }
  wrapper.classList.remove('hidden');
  const sel = document.getElementById('week-selector');
  sel.innerHTML = '';
  [...cfWeeks].reverse().forEach(w => {
    const opt = document.createElement('option');
    opt.value = w.week;
    opt.textContent = `Week ${w.week} ‚Äî ${w.tournament || 'TBD'} (${w.status})`;
    if (w.week === cfStatus.currentWeek) opt.selected = true;
    sel.appendChild(opt);
  });
  sel.onchange = () => renderPicksTab(parseInt(sel.value));
}

// ‚îÄ‚îÄ Submit Pick ‚îÄ‚îÄ
async function submitPick() {
  const name = document.getElementById('pick-name').value;
  const golfer = document.getElementById('pick-golfer').value.trim();
  if (!name) { showToast('Select your name', 'error'); return; }
  if (!golfer) { showToast('Enter a golfer', 'error'); return; }

  const btn = document.getElementById('btn-submit');
  btn.disabled = true; btn.textContent = 'Submitting‚Ä¶';

  try {
    const resp = await fetch(CF_BASE + '/submit', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ name, golferPick: golfer })
    });
    const data = await resp.json();
    if (resp.ok) {
      showToast('Pick locked in!', 'success');
      if (typeof confetti === 'function') {
        confetti({ particleCount: 80, spread: 60, origin: { y: 0.7 }, colors: ['#c9a84c','#4caf50','#f5f0e8'] });
      }
      document.getElementById('pick-golfer').value = '';
      await renderPicksTab(cfStatus.currentWeek);
    } else {
      showToast(data.error || 'Submission failed', 'error');
    }
  } catch (e) {
    showToast('Network error', 'error');
  }
  btn.disabled = false; btn.textContent = 'Lock It In';
}

// ‚îÄ‚îÄ Admin ‚îÄ‚îÄ
function authAdmin() {
  adminKey = document.getElementById('admin-key').value;
  if (adminKey) {
    localStorage.setItem('golf_admin_key', adminKey);
    document.getElementById('admin-pre-auth').classList.add('hidden');
    document.getElementById('admin-controls').classList.remove('hidden');
    showToast('Admin authenticated', 'info');
  }
}

// Restore admin UI if key already saved
if (adminKey) {
  document.addEventListener('DOMContentLoaded', () => {
    const preAuth = document.getElementById('admin-pre-auth');
    const controls = document.getElementById('admin-controls');
    if (preAuth && controls) {
      preAuth.classList.add('hidden');
      controls.classList.remove('hidden');
    }
  });
}

async function adminAction(action) {
  try {
    const resp = await fetch(CF_BASE + '/admin', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json', 'X-Admin-Key': adminKey },
      body: JSON.stringify({ action })
    });
    const data = await resp.json();
    if (resp.ok) {
      showToast(`${action} complete`, 'success');
      await fetchCFStatus();
      await fetchCFWeeks();
      renderWeekSelector();
      await renderPicksTab(cfStatus.currentWeek);
    } else {
      showToast(data.error || 'Admin action failed', 'error');
    }
  } catch (e) {
    showToast('Network error', 'error');
  }
}

// ‚îÄ‚îÄ Standings Tab ‚îÄ‚îÄ
function renderStandings() {
  const container = document.getElementById('standings-content');
  const totals = sheetData.standings.totals || {};
  const avgs = sheetData.standings.avgs || {};

  // Build sorted rankings
  const ranked = MEMBERS.map(m => ({
    name: m,
    total: totals[m] || 0,
    avg: avgs[m] || 0
  })).sort((a, b) => b.total - a.total);

  const maxTotal = ranked[0]?.total || 1;
  const winner = sheetData.winner;

  let html = '';

  // Winner Banner
  if (winner.name) {
    html += `<div class="winner-banner fade-up">
      <div class="trophy">üèÜ</div>
      <div class="winner-name">${winner.name}</div>
      <div class="winner-lead">Leading by ${winner.by || '‚Äî'}</div>
    </div>`;
  }

  // Podium
  if (ranked.length >= 3) {
    html += `<div class="podium fade-up stagger-1">
      <div class="podium-spot second">
        <div class="podium-medal">ü•à</div>
        <div class="podium-name">${ranked[1].name}</div>
        <div class="podium-earnings">${fmtDollar(ranked[1].total)}</div>
      </div>
      <div class="podium-spot first">
        <div class="podium-medal">ü•á</div>
        <div class="podium-name">${ranked[0].name}</div>
        <div class="podium-earnings">${fmtDollar(ranked[0].total)}</div>
      </div>
      <div class="podium-spot third">
        <div class="podium-medal">ü•â</div>
        <div class="podium-name">${ranked[2].name}</div>
        <div class="podium-earnings">${fmtDollar(ranked[2].total)}</div>
      </div>
    </div>`;
  }

  // Full Rankings
  html += '<div class="section-label fade-up stagger-2">Full Rankings</div><div class="rankings-list">';
  ranked.forEach((p, i) => {
    const barW = maxTotal > 0 ? Math.round((p.total / maxTotal) * 100) : 0;
    html += `<div class="rank-row fade-up stagger-${Math.min(i + 3, 10)}">
      <div class="rank-num">${i + 1}</div>
      <div class="rank-info">
        <div class="rank-name">${p.name}</div>
        <div class="rank-avg">Avg: ${fmtDollar(p.avg)} / week</div>
      </div>
      <div class="rank-total">${fmtDollar(p.total)}</div>
      <div class="rank-bar-container"><div class="rank-bar" style="width:${barW}%"></div></div>
    </div>`;
  });
  html += '</div>';

  container.innerHTML = html;
}

// ‚îÄ‚îÄ History Tab ‚îÄ‚îÄ
function renderHistory() {
  const container = document.getElementById('history-content');
  const tournaments = [...sheetData.tournaments].reverse();
  const count = tournaments.length;

  // Find top earner overall
  const totals = {};
  sheetData.tournaments.forEach(t => {
    t.picks.forEach(p => {
      totals[p.member] = (totals[p.member] || 0) + p.earnings;
    });
  });
  let topEarner = '';
  let topVal = 0;
  for (const [name, val] of Object.entries(totals)) {
    if (val > topVal) { topVal = val; topEarner = name; }
  }

  let html = `<div class="summary-chips fade-up">
    <span class="summary-chip">${count} Tournament${count !== 1 ? 's' : ''} Complete</span>
    ${topEarner ? `<span class="summary-chip">Top Earner: ${topEarner}</span>` : ''}
  </div>`;

  tournaments.forEach((t, idx) => {
    const sorted = [...t.picks].sort((a, b) => b.earnings - a.earnings);
    const topWeekEarnings = sorted[0]?.earnings || 0;
    const maxBarRef = 400000; // scale reference for mini bars
    const miniW = topWeekEarnings > 0 ? Math.min(100, Math.round((topWeekEarnings / maxBarRef) * 100)) : 0;
    const expanded = idx === 0 ? ' expanded' : '';

    html += `<div class="tourney-card fade-up stagger-${Math.min(idx + 1, 10)}${expanded}" onclick="toggleTourney(this)">
      <div class="tourney-header">
        <div class="tourney-title-group">
          <div class="tourney-name">${t.name}</div>
          <div class="tourney-date">${t.date}</div>
        </div>
        <div class="tourney-mini-bar"><div class="tourney-mini-bar-fill" style="width:${miniW}%"></div></div>
        <span class="tourney-chevron">‚ñæ</span>
      </div>
      <div class="tourney-body"><div class="tourney-body-inner">`;

    sorted.forEach((p, pi) => {
      const isTop = pi === 0 && p.earnings > 0;
      const eClass = p.earnings > 0 ? 'positive' : 'zero';
      const pickText = (!p.pick || p.pick.toUpperCase() === 'NO PICK')
        ? '<span class="tpr-pick no-pick">NO PICK</span>'
        : `<span class="tpr-pick">${p.pick}</span>`;
      html += `<div class="tourney-pick-row">
        <div class="tpr-left">
          <span class="tpr-rank${isTop ? ' first' : ''}">${pi + 1}</span>
          <div>
            <div class="tpr-name">${p.member}${isTop ? ' <span class="tpr-trophy">üèÜ</span>' : ''}</div>
            ${pickText}
          </div>
        </div>
        <span class="tpr-earnings ${eClass}">${fmtDollar(p.earnings)}</span>
      </div>`;
    });

    html += '</div></div></div>';
  });

  container.innerHTML = html;
}

function toggleTourney(card) {
  // Only toggle if the click target isn't inside the body
  card.classList.toggle('expanded');
}

// ‚îÄ‚îÄ Players Tab ‚îÄ‚îÄ
function renderPlayers() {
  const container = document.getElementById('players-content');

  // Most Picked Golfers
  const golferMap = {}; // golferName -> { count, totalEarnings }
  sheetData.tournaments.forEach(t => {
    t.picks.forEach(p => {
      if (!p.pick || p.pick.toUpperCase() === 'NO PICK') return;
      const name = p.pick.trim();
      if (!golferMap[name]) golferMap[name] = { count: 0, earnings: 0 };
      golferMap[name].count++;
      golferMap[name].earnings += p.earnings;
    });
  });
  const golferList = Object.entries(golferMap)
    .map(([name, data]) => ({ name, ...data }))
    .sort((a, b) => b.count - a.count || b.earnings - a.earnings)
    .slice(0, 15);

  let html = '<div class="section-label fade-up">Most Picked Golfers</div>';
  html += '<div class="card fade-up stagger-1"><div class="most-picked-list">';
  golferList.forEach((g, i) => {
    html += `<div class="mp-row">
      <span class="mp-rank">${i + 1}</span>
      <span class="mp-name">${g.name}</span>
      <span class="mp-count">${g.count}√ó</span>
      <span class="mp-earnings">${fmtDollar(g.earnings)}</span>
    </div>`;
  });
  html += '</div></div>';

  // Member Used Players
  html += '<div class="section-label fade-up stagger-2 mt-16">Used Players by Member</div>';
  MEMBERS.forEach((member, mi) => {
    const usedPicks = [];
    sheetData.tournaments.forEach(t => {
      const p = t.picks.find(pk => pk.member === member);
      if (p && p.pick && p.pick.toUpperCase() !== 'NO PICK') {
        usedPicks.push({ tournament: t.date || t.name, golfer: p.pick, earnings: p.earnings });
      }
    });

    const uniqueGolfers = new Set(usedPicks.map(p => p.golfer)).size;

    html += `<div class="member-card fade-up stagger-${Math.min(mi + 3, 10)}" onclick="toggleMember(this)">
      <div class="member-card-header">
        <div>
          <div class="member-card-name">${member}</div>
          <div class="member-card-count">${uniqueGolfers} player${uniqueGolfers !== 1 ? 's' : ''} used</div>
        </div>
        <span class="member-card-chevron">‚ñæ</span>
      </div>
      <div class="member-card-body"><div class="member-card-body-inner">`;

    usedPicks.forEach(p => {
      const eClass = p.earnings > 0 ? 'positive' : 'zero';
      html += `<div class="member-pick-item">
        <span class="mpi-tourney">${p.tournament}</span>
        <span class="mpi-golfer">${p.golfer}</span>
        <span class="mpi-earnings ${eClass}">${fmtDollar(p.earnings)}</span>
      </div>`;
    });

    html += '</div></div></div>';
  });

  container.innerHTML = html;
}

function toggleMember(card) {
  card.classList.toggle('expanded');
}

// ‚îÄ‚îÄ Init ‚îÄ‚îÄ
async function init() {
  try {
    await Promise.all([
      fetchSheetData(),
      fetchCFStatus(),
      fetchCFWeeks()
    ]);
  } catch (e) {
    console.error('Init error:', e);
  }

  // Hide loading, show app
  document.getElementById('loading-screen').style.display = 'none';
  document.getElementById('app').style.display = 'block';
  document.getElementById('bottom-nav').style.display = 'flex';

  // Render picks tab
  renderWeekSelector();
  await renderPicksTab(cfStatus.currentWeek);

  // Auto-update timer
  setInterval(updateLastUpdated, 30000);
}

init();
</script>
</body>
</html>
